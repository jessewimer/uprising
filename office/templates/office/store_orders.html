{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="csrf-token" content="{{ csrf_token }}">
    <title>Process Store Orders</title>
    <link rel="stylesheet" href="{% static 'office/css/store_orders.css' %}">

</head>
<body>

    <div class="container">
        <!-- Header Section -->
        <div class="header">
            <div class="header-content">
                <div class="brand-section">
                    <button class="dashboard-btn" id="dashboard-btn">‚Üê Dashboard</button>
                    <h1 class="brand-title">Process Store Orders</h1>
                </div>
                <div class="controls-section">
                    <div class="dropdowns">
                        <select id="store-filter" class="dropdown">
                            <option value="">All Stores</option>
                            {% for store in stores %}
                            <option value="{{ store.store_num }}">{{ store.store_name }}</option>
                            {% endfor %}
                        </select>
                        <select id="order-filter" class="dropdown" disabled>
                            <option value="">Select Order</option>
                        </select>
                    </div>
                    <div class="action-buttons">
                        <button class="btn" id="pending-btn">Pending</button>
                        <button class="btn" id="pick-list-btn">Pick List</button>
                        <button class="btn" id="finalize-btn">Finalize</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Main Content Area -->
        <div class="main-content">
            <!-- Order Builder -->
            <div class="order-builder">
                <div class="order-header">
                    <div class="order-title-section">
                        <h2 class="order-title">Order Builder</h2>
                        <button class="save-btn" id="save-order-btn" disabled>Save Changes</button>
                        <div id="unsaved-indicator" style="display: none; background: rgba(255, 193, 7, 0.2); border: 1px solid #ffc107; color: #856404; padding: 6px 12px; border-radius: 6px; font-size: 0.85rem; font-weight: 500;">
                            Unsaved changes
                        </div>
                    </div>
                    <div class="order-stats">
                        <div class="stat-item">
                            <span class="stat-label">Unique Items</span>
                            <span class="stat-value" id="unique-items-count">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Total Packets</span>
                            <span class="stat-value" id="total-packets-count">0</span>
                        </div>
                    </div>
                </div>
                <div class="order-table-container" id="order-table-container">
                    <div class="empty-order">
                        <div class="empty-order-icon">üì¶</div>
                        <p>No items in order</p>
                        <small>Search and add varieties from the right panel</small>
                    </div>
                </div>
            </div>
            
            <!-- Variety Lookup -->
            <div class="variety-lookup">
                <div class="lookup-header">
                    <h2 class="lookup-title">Lookup By:</h2>
                    <div class="lookup-type-buttons">
                        <button class="lookup-type-btn active" id="lookup-variety-btn">Variety</button>
                        <button class="lookup-type-btn" id="lookup-crop-btn">Crop</button>
                    </div>
                    <input type="text" class="search-box" id="variety-search" placeholder="Search varieties by name...">
                </div>
                <div class="lookup-results" id="lookup-results">
                    <div class="no-results">
                        <p>Start typing to search</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Success Notification Card -->
    <div id="notification" class="notification">
        <div class="notification-icon">‚úì</div>
        <div class="notification-content">
            <div class="notification-title">Success!</div>
            <div class="notification-message">Order saved successfully</div>
        </div>
        <button class="notification-close" onclick="hideNotification()">&times;</button>
    </div>

    <!-- Pending Orders Modal -->
    <div id="pending-orders-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Pending Orders</h3>
                <span class="close" id="close-pending-modal">&times;</span>
            </div>
            <div class="modal-body">
                <div id="pending-orders-container">
                    <div style="text-align: center; padding: 20px;">
                        <div style="font-size: 2rem; margin-bottom: 10px;">‚è≥</div>
                        <p>Loading pending orders...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="delete-confirm-modal" class="modal">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h3 class="modal-title">Remove Item</h3>
                <span class="close" id="close-delete-modal">&times;</span>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to remove <strong id="delete-item-name"></strong> from the order?</p>
                <div class="modal-actions">
                    <button class="btn btn-secondary" id="cancel-delete-btn">Cancel</button>
                    <button class="btn" style="background: #ff6b6b;" id="confirm-delete-btn">Remove</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Variety Modal -->
    <div id="add-variety-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Add Variety to Order</h3>
                <span class="close" id="close-variety-modal">&times;</span>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Variety:</label>
                    <div id="selected-variety-name" style="font-weight: 600; padding: 10px; background: #f8f9fa; border-radius: 8px;"></div>
                </div>
                <div class="form-group">
                    <label for="variety-qty" class="form-label">Quantity:</label>
                    <input type="number" id="variety-qty" class="form-input" min="1" value="1">
                </div>
                <div class="form-group">
                    <div class="checkbox-group">
                        <input type="checkbox" id="variety-photo" class="checkbox-input">
                        <label for="variety-photo" class="form-label">Include Photo</label>
                         
                    </div>
                </div>
                <div class="modal-actions">
                    <button class="btn btn-secondary" id="cancel-variety-btn">Cancel</button>
                    <button class="btn btn-success" id="save-variety-btn">Save</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Finalize Confirmation Modal -->
    <div id="finalize-confirm-modal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h3 class="modal-title">Finalize Order</h3>
                <span class="close" id="close-finalize-modal">&times;</span>
            </div>
            <div class="modal-body">
                <div style="text-align: center; margin-bottom: 20px;">
                    <div style="font-size: 3rem; color: #f39c12; margin-bottom: 10px;">üìã</div>
                    <p style="font-size: 1.1rem; margin-bottom: 10px;">Are you sure you want to finalize this order?</p>
                    <p style="color: #666; font-size: 0.9rem;">This will mark it as fulfilled and send it to printing. This action cannot be undone.</p>
                </div>
                <div id="finalize-order-summary" style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 15px 0;">
                    <div style="font-weight: 600; margin-bottom: 8px;">Order Summary:</div>
                    <div id="finalize-items-count"></div>
                    <div id="finalize-packets-count"></div>
                </div>
                <div class="modal-actions">
                    <button class="btn btn-secondary" id="cancel-finalize-btn">Cancel</button>
                    <button class="btn" style="background: linear-gradient(135deg, #f39c12, #e67e22);" id="confirm-finalize-btn">Finalize Order</button>
                </div>
            </div>
        </div>
    </div>
    <div id="edit-item-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Edit Item</h3>
                <span class="close" id="close-edit-modal">&times;</span>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Variety:</label>
                    <div id="edit-item-name" style="font-weight: 600; padding: 10px; background: #f8f9fa; border-radius: 8px; margin-bottom: 15px;"></div>
                </div>
                <div class="form-group">
                    <div class="checkbox-group">
                        <input type="checkbox" id="edit-item-photo" class="checkbox-input">
                        <label for="edit-item-photo" class="form-label">Include Photo</label>
                    </div>
                </div>
                <div class="modal-actions">
                    <button class="btn btn-secondary" id="cancel-edit-btn">Cancel</button>
                    <button class="btn btn-success" id="save-edit-btn">Save Changes</button>
                </div>
                <hr style="margin: 20px 0; border: none; height: 1px; background: #e1e5e9;">
                <div style="text-align: center;">
                    <button class="btn" style="background: #ff6b6b;" id="remove-item-btn">Remove Item</button>
                </div>
            </div>
        </div>
    </div>



    <!-- Bulk Photo Modal -->
    <div id="bulk-photo-modal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h3>Bulk Photo Action</h3>
                <button class="modal-close" onclick="closeBulkPhotoModal()">&times;</button>
            </div>
            <div class="modal-body">
                <p style="margin-bottom: 20px;">Choose an action for all items in this order:</p>
                <div style="display: flex; flex-direction: column; gap: 10px;">
                    <button class="btn" style="background: #26de81;" onclick="includeAllPhotos()">‚úÖ Include Photo for All Items</button>
                    <button class="btn" style="background: #ff6b6b;" onclick="removeAllPhotos()">‚ùå Remove Photo for All Items</button>
                    <button class="btn" style="background: #6c757d;" onclick="closeBulkPhotoModal()">Cancel</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Pick List Confirmation Modal -->
    <div id="pick-list-confirm-modal" class="modal">
        <div class="modal-content" style="max-width: 450px;">
            <div class="modal-header">
                <h3 class="modal-title">Pick List Already Printed</h3>
                <span class="close" id="close-pick-list-modal">&times;</span>
            </div>
            <div class="modal-body">
                <div style="text-align: center; margin-bottom: 20px;">
                    <div style="font-size: 3rem; color: #f39c12; margin-bottom: 10px;">üìã</div>
                    <p style="font-size: 1.1rem; margin-bottom: 10px;">A pick list has already been printed for this order.</p>
                    <p style="color: #666; font-size: 0.9rem;">Do you want to print it again?</p>
                </div>
                <div class="modal-actions">
                    <button class="btn btn-secondary" id="cancel-pick-list-btn">Cancel</button>
                    <button class="btn" style="background: linear-gradient(135deg, #f39c12, #e67e22);" id="confirm-pick-list-btn">Print Again</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Shipping Input Modal -->
    <div id="shipping-modal" class="modal">
        <div class="modal-content" style="max-width: 450px;">
            <div class="modal-header">
                <h3 class="modal-title">Enter Shipping Cost</h3>
                <span class="close" id="close-shipping-modal">&times;</span>
            </div>
            <div class="modal-body">
                <div style="text-align: center; margin-bottom: 20px;">
                    <div style="font-size: 3rem; color: #667eea; margin-bottom: 10px;">üöö</div>
                    <p style="font-size: 1.1rem; margin-bottom: 20px;">Enter the shipping cost for this order</p>
                </div>
                <div class="form-group">
                    <label for="shipping-amount" class="form-label">Shipping Amount ($):</label>
                    <input 
                        type="text" 
                        id="shipping-amount" 
                        class="form-input" 
                        placeholder="0.00"
                        inputmode="decimal"
                    >
                    <div id="shipping-error" style="display: none; color: #ff6b6b; font-size: 0.9rem; margin-top: 8px;">
                        Please enter a valid dollar amount (e.g., 0.00, 15.50)
                    </div>
                </div>
                <div class="modal-actions">
                    <button class="btn btn-secondary" id="cancel-shipping-btn">Cancel</button>
                    <button class="btn btn-success" id="confirm-shipping-btn">Continue</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Pass Django data to JavaScript
        window.varietyData = JSON.parse('{{ variety_data|escapejs }}');
        </script>

        <!-- Load external JS -->
    <script src="{% static 'office/js/store_orders.js' %}"></script>
</body>
</html>
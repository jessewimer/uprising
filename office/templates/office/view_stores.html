{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>View Stores - Uprising Seeds</title>

    <link rel="stylesheet" href="{% static 'office/css/base.css' %}">
    <link rel="stylesheet" href="{% static 'office/css/view_stores.css' %}">

</head>

<body>
    <div class="container">
        <!-- Header Section -->
        <div class="header">
            <a href="{% url 'office_landing' %}" class="back-button">← Dashboard</a>
            <div class="header-content">
                <h1 class="brand-title">Store Directory</h1>
                <p class="brand-subtitle">View/Edit Wholesale Stores</p>
            </div>
            <div style="display: flex; gap: 15px;">
                <button class="sales-button returns-button" onclick="openSalesModal()">Sales</button>
                <button class="returns-button" onclick="openReturnsModal()">Returns</button>
            </div>
        </div>

        <!-- Table Container -->
        <div class="table-container">
            <!-- Column Toggle Controls -->
            <div class="column-controls">
                <button class="toggle-btn active" data-group="contact">Contact Info</button>
                <button class="toggle-btn" data-group="rack">Rack Details</button>
                <button class="toggle-btn" data-group="order">Order Info</button>
            </div>

            <div class="table-wrapper" id="tableWrapper">
                <table class="stores-table">
                    <thead>
                        <tr>
                            <th>Store #</th>
                            <th>Store Name</th>
                            <!-- Contact Info Group -->
                            <th class="col-group-contact">Contact Name</th>
                            <th class="col-group-contact">Phone</th>
                            <th class="col-group-contact">Email</th>
                            <th class="col-group-contact">Address</th>
                            <th class="col-group-contact">City</th>
                            <th class="col-group-contact">State</th>
                            <th class="col-group-contact">ZIP</th>
                    
                            <!-- Rack Details Group -->
                            <th class="col-group-rack">Slots</th>
                            <th class="col-group-rack">Header</th>
                            <th class="col-group-rack">Velcro</th>
                            <th class="col-group-rack">Material</th>
                            <th class="col-group-rack">Rack #</th>
                            <!-- Order Info Group -->
                            <th class="col-group-order">First Order</th>
                            <th>Edit</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for store in stores %}
                        <tr>
                            <td class="store-num">
                                {% if store.store_num %}
                                    <strong>#{{ store.store_num }}</strong>
                                {% else %}
                                    <span style="color: #999;">--</span>
                                {% endif %}
                            </td>
                            <td>
                                <div class="store-name">
                                    {{ store.store_name|default:"Unnamed Store" }}
                                </div>
                            </td>
                            <!-- Contact Info Group -->
                            <td class="col-group-contact">
                                {{ store.store_contact_name|default:"--" }}
                            </td>
                            <td class="col-group-contact">
                                {% if store.store_contact_phone %}
                                    <span class="phone-number">{{ store.store_contact_phone }}</span>
                                {% else %}
                                    <span style="color: #999;">--</span>
                                {% endif %}
                            </td>
                            <td class="col-group-contact">
                                {% if store.store_contact_email %}
                                    <a href="mailto:{{ store.store_contact_email }}" class="email-link">{{ store.store_contact_email }}</a>
                                {% else %}
                                    <span style="color: #999;">--</span>
                                {% endif %}
                            </td>
                            <td class="col-group-contact">
                                {{ store.store_address|default:"--" }}
                            </td>
                            <td class="col-group-contact">
                                {{ store.store_city|default:"--" }}
                            </td>
                            <td class="col-group-contact">
                                {{ store.store_state|default:"--" }}
                            </td>
                            <td class="col-group-contact">
                                {{ store.store_zip|default:"--" }}
                            </td>
      
                            <!-- Rack Details Group -->
                            <td class="col-group-rack">
                                {% if store.slots %}
                                    <strong>{{ store.slots }}</strong>
                                {% else %}
                                    <span style="color: #999;">--</span>
                                {% endif %}
                            </td>
                            <td class="col-group-rack">
                                {{ store.rack_header|default:"--" }}
                            </td>
                            <td class="col-group-rack">
                                {% if store.velcro_required %}
                                    <span class="boolean-indicator boolean-true">✓</span>
                                {% else %}
                                    <span class="boolean-indicator boolean-false">✗</span>
                                {% endif %}
                            </td>
                            <td class="col-group-rack">
                                {{ store.rack_material|default:"--" }}
                            </td>
                            <td class="col-group-rack">
                                {{ store.rack_num|default:"--" }}
                            </td>
                            <!-- Order Info Group -->
                            <td class="col-group-order">
                                {% if store.first_order_date %}
                                    {{ store.first_order_date|date:"Y-m-d" }}
                                {% else %}
                                    <span style="color: #999;">--</span>
                                {% endif %}
                            </td>
                            <td>
                                <button class="edit-btn"
                                        data-store-id="{{ store.id }}"
                                        data-store-num="{{ store.store_num }}"
                                        data-store-name="{{ store.store_name|default:'Unnamed Store'|escapejs }}"
                                        data-store-email="{{ store.store_contact_email|default:''}}"
                                        data-store-phone="{{ store.store_contact_phone|default:''}}"
                                        data-store-slots="{{ store.slots|default:''}}"
                                        data-contact-name="{{ store.store_contact_name|default:''|escapejs }}">
                                    <svg viewBox="0 0 24 24">
                                        <path d="m18 2 4 4-12 12H6v-4L18 2z"/>
                                        <path d="m21.5 6.5-4-4"/>
                                    </svg>
                                </button>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Returns Overview Modal -->
    <div class="modal-overlay" id="returnsModal">
        <div class="modal modal-large">
            <div class="modal-header">
                <h3 class="modal-title">Store Returns Overview</h3>
                <button class="close-btn" onclick="closeReturnsModal()">&times;</button>
            </div>

            <!-- Year Filter -->
            <div class="returns-filter">
                <label for="yearFilter">Sales Year:</label>
                <select id="yearFilter" class="form-select" onchange="loadReturnsData()">
                    <option value="">Loading years...</option>
                </select>
            </div>

            <!-- Returns Table -->
            <div class="table-wrapper">
                <table class="returns-table">
                    <thead>
                        <tr>
                            <th>Store #</th>
                            <th>Store Name</th>
                            <th># Pkts Allowed</th>
                            <th># Returned</th>
                            <th>Credit</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="returnsTableBody">
                        <tr>
                            <td colspan="6" style="text-align: center; padding: 40px;">
                                <div class="loading-spinner"></div>
                                <p style="margin-top: 10px;">Loading data...</p>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Add/Edit Returns Modal -->
    <div class="modal-overlay" id="addReturnsModal">
        <div class="modal" style="max-width: 500px;">
            <div class="modal-header">
                <h3 class="modal-title" id="addReturnsModalTitle">Record Returns</h3>
                <button class="close-btn" onclick="closeAddReturnsModal()">&times;</button>
            </div>

            <div id="addReturnsSuccessMessage" class="success-message">
                Returns recorded successfully!
            </div>

            <form id="addReturnsForm">
                <div class="form-group">
                    <label class="form-label" for="addReturnsStoreName">Store</label>
                    <input type="text" id="addReturnsStoreName" class="form-input" readonly>
                    <input type="hidden" id="addReturnsStoreNum">
                </div>

                <div class="form-group">
                    <label class="form-label" for="addReturnsYear">Sales Year</label>
                    <input type="text" id="addReturnsYear" class="form-input" readonly>
                </div>

                <div class="form-group">
                    <label class="form-label" for="addReturnsPackets"># Packets Returned *</label>
                    <input type="number" 
                           id="addReturnsPackets" 
                           class="form-input" 
                           min="0" 
                           required 
                           placeholder="e.g., 150">
                    <div class="error-message" id="packets_error"></div>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeAddReturnsModal()">Cancel</button>
                    <button type="submit" class="btn btn-success">Save Returns</button>
                </div>
            </form>
        </div>
    </div>


    <!-- Sales Overview Modal -->
    <div class="modal-overlay" id="salesModal">
        <div class="modal modal-large">
            <div class="modal-header">
                <h3 class="modal-title">Store Sales Overview</h3>
                <button class="close-btn" onclick="closeSalesModal()">&times;</button>
            </div>

            <!-- Year Filter -->
            <div class="returns-filter">
                <label for="salesYearFilter">Sales Year:</label>
                <select id="salesYearFilter" class="form-select" onchange="loadSalesData()">
                    <option value="">Loading years...</option>
                </select>
            </div>

            <!-- Sales Table -->
            <div class="table-wrapper">
                <table class="sales-table returns-table">
                    <thead>
                        <tr>
                            <th>Store #</th>
                            <th>Store Name</th>
                            <th style="text-align: right;">Total # Pkts</th>
                            <th style="text-align: right;">Subtotal</th>
                            <th style="text-align: right;">Shipping</th>
                            <th style="text-align: right;">Total</th>
                        </tr>
                    </thead>
                    <tbody id="salesTableBody">
                        <tr>
                            <td colspan="6" style="text-align: center; padding: 40px;">
                                <div class="loading-spinner"></div>
                                <p style="margin-top: 10px;">Loading data...</p>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Edit Store Modal -->
    <div class="modal-overlay" id="editModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Edit Store Information</h3>
                <button class="close-btn" onclick="closeEditModal()">&times;</button>
            </div>
            <form id="editStoreForm">
                <!-- Basic Info -->
                <div class="form-group">
                    <label class="form-label" for="storeName">Store Name</label>
                    <input type="text" id="storeName" class="form-input" required>
                </div>
                
                <!-- Contact Info -->
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label" for="contactName">Contact Name</label>
                        <input type="text" id="contactName" class="form-input">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="contactPhone">Phone</label>
                        <input type="tel" id="contactPhone" class="form-input">
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label" for="contactEmail">Email</label>
                    <input type="text" id="contactEmail" class="form-input">
                </div>

                <!-- Address Info -->
                <div class="form-group">
                    <label class="form-label" for="storeAddress">Address</label>
                    <textarea id="storeAddress" class="form-input form-textarea"></textarea>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label" for="storeCity">City</label>
                        <input type="text" id="storeCity" class="form-input">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="storeState">State/Province</label>
                        <input type="text" id="storeState" class="form-input">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label" for="storeZip">ZIP/Postal Code</label>
                        <input type="text" id="storeZip" class="form-input">
                    </div>
                </div>

                <!-- Rack Info -->
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label" for="storeSlots">Slots</label>
                        <input type="number" id="storeSlots" class="form-input" min="0">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="rackNum">Rack Number</label>
                        <input type="text" id="rackNum" class="form-input">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label" for="header">Header</label>
                        <input type="text" id="header" class="form-input">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="rackMaterial">Rack Material</label>
                        <input type="text" id="rackMaterial" class="form-input">
                    </div>
                </div>

                <div class="form-group">
                    <div class="checkbox-group">
                        <input type="checkbox" id="velcro" class="form-checkbox">
                        <label class="form-label" for="velcro">Velcro Required</label>
                    </div>
                </div>

                <!-- Order Info -->
                <div class="form-group">
                    <label class="form-label" for="firstOrder">First Order</label>
                    <input type="text" id="firstOrder" class="form-input">
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeEditModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Changes</button>
                </div>
            </form>
        </div>
    </div>

    <script src="{% static 'office/js/view_stores.js' %}"></script>
</body>
</html>